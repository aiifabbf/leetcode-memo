r"""
.. default-role:: math

总共 `n` 个硬币，第 `i` 个硬币正面朝上的概率是 ``prob[i]`` ，每个硬币都只抛一次，问总共有 ``target`` 个硬币正面朝上的概率是多少。

暴力做法就是生成从 `n` 个硬币里面取 ``target`` 个硬币的所有可能的组合，然后把这些组合发生的概率加起来。从 `n` 个硬币里面取 `t` 个硬币总共有 `C_n^t` 种组合。

看问题描述的规模，感觉是要找一个 `O(n^2)` 的复杂度算法。

考虑用DP。对于第 `i` 个硬币，只有两种情况

-   正面朝上
-   反面朝上

所以把子问题 ``OPT[k, t]`` 定义为前 `k` 个硬币正好有 `t` 个硬币正面朝上的概率。考虑 ``OPT[k, t]`` 和前面的项有什么关系。

第 `k - 1` 个硬币有两种情况

-   有 ``prob[k - 1]`` 的概率正面朝上
-   有 ``1 - prob[k - 1]`` 的概率反面朝上

所以递推式很容易得出

.. math::

    \operatorname{OPT}(k, t) = p_{k - 1} \cdot \operatorname{OPT}(k - 1, t - 1) + (1 - p_{k - 1}) \cdot \operatorname{OPT}(k - 1, t)

原问题的答案是

.. math::

    \operatorname{OPT}(n, T)

考虑初始条件，主要考虑三种初始条件

-   前0个硬币里有0个硬币正面朝上的概率

    也就是 `k = 0, t = 0` 的情况，这个很显然（又显然了），前0个硬币里有0个硬币朝上的概率是100%，所以

    .. math::

        \operatorname{OPT}(0, 0) = 1

    如果这个想不通，可以从概率分布函数的归一性质来考虑：对于任意一个正数 `t` ，前0个硬币里有 `t` 个硬币朝上的概率都是0，所以 `t = 0` 的时候，这个概率是1，不然概率分布在 `t \in N` 上就不归一了。

-   前0个（ `t > 0` ）硬币里有 `t` 个硬币正面朝上的概率

    不用想了，你都没有硬币，怎么可能做到有正数个硬币正面朝上呢？所以

    .. math::

        \forall t > 0: \quad \operatorname{OPT}(0, t) = 1

-   前 `k` 个（ `k > 0` ）硬币里有0个硬币正面朝上的概率

    这个也很简单，有0个硬币正面朝上就是前 `k` 个硬币全都正面朝下，所以

    .. math::

        \forall k > 0: \quad \operatorname{OPT}(k, 0) = \prod_{i = 0}^{k - 1} (1 - p_i)

    也可以写成递推形式

    .. math::

        \forall k > 0: \quad \operatorname{OPT}(k, 0) = \operatorname{OPT}(k - 1, 0) \cdot (1 - p_{k - 1})
"""

from typing import *

class Solution:
    def probabilityOfHeads(self, prob: List[float], target: int) -> float:
        dp = {}
        length = len(prob)

        # 初始条件
        dp[0, 0] = 1 # k = 0, t = 0的时候、也就是前0个硬币里有0个硬币正面朝上的概率是100%
        
        for t in range(1, target + 1): # 对任意t > 0，OPT[0, t] = 0
            dp[0, t] = 0

        for k in range(1, length + 1): # 对任意k > 0, OPT[k, 0] = OPT[k - 1, 0] * (1 - prob[k - 1])
            dp[k, 0] = dp[k - 1, 0] * (1 - prob[k - 1])

        # 填表
        for k in range(1, length + 1):

            for t in range(1, target + 1):
                dp[k, t] = prob[k - 1] * dp[k - 1, t - 1] + (1 - prob[k - 1]) * dp[k - 1, t]

        # 原问题的解是OPT[n, T]
        return dp[length, target]

s = Solution()
print(s.probabilityOfHeads([0.4,], 1)) # 0.4
print(s.probabilityOfHeads([0.5, 0.5, 0.5, 0.5, 0.5], 0)) # 0.03125
print(s.probabilityOfHeads([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], 99)) # 0
print(s.probabilityOfHeads([0.7276446192251871,0.2764886055549236,0.02216739771404641,0.05557187712012801,0.34184247478682417,0.25926671588099104,0.18966174909003153,0.21918502040684074,0.8690081625543158,0.3678485062695376,0.3554304713295561,0.08573906861338232,0.1423441807930378,0.28281615102120194,0.521761480694787,0.09422019059657927,0.12753447162997822,0.2655227594410564,0.3791125992693072,0.12701987382568614,0.46294761659672323,0.7053811782953948,0.07558852720402753,0.42128919110987817,0.021092668541842552,0.826351577094432,0.5749247844755899,0.7316475206010851,0.32919615889707143,0.4589758637129475,0.7805623324870211,0.6849476588315266,0.8122586648115944,0.7048898493940556,0.2364209639703857,0.6632538647684144,0.6866236851358891,0.4365735714130389,0.22810244068177665,0.14789886629722582,0.09460763906083347,0.4836652180902238,0.9382100379614552,0.46785765751521613,0.5472069920787261,0.7922763822353801,0.9887941887053847,0.9863978046708035,0.10936810093642735,0.5937285780702746,0.6406507527984818,0.22896610473949286,0.5619243741535656,0.8306784868820543,0.1384013699290344,0.4876369393839334,0.044750226470057,0.035169481319878404,0.6089405693453448,0.5657737191626404,0.16121884011186327,0.21105405179647307,0.4572318552623169,0.646930566869538,0.9555653104025189,0.12407800274286995,0.34787735002641496,0.6841920834330344,0.7815047657649712,0.0031374025378922976,0.08403706837116898,0.6435703800845906,0.3483734768005754,0.8771688489494952,0.7977500930725314,0.3367954183240893,0.6412225693704577,0.9967081718221309,0.07478296975115284,0.16281978809097353,0.6938369499641489,0.22323589992127624,0.4430759843962313,0.46576392597345107,0.21621926925521262,0.25469271262558557,0.7425854539523526,0.6647445469024968,0.003150711873091905,0.21217352741238993,0.6179129114339678,0.019080720086129155,0.32226892609018354,0.9715508653647768,0.5584784365445217,0.5118586825925566,0.698706038575217,0.411504430423427,0.7034610603859301,0.521073852846602,0.09239122935089905,0.7501681690771498,0.49137253516740387,0.037072503121835076,0.74348368934191,0.2185159788174117,0.0459169990820395,0.3700733847630976,0.6596148777652967,0.2802533239074183,0.5815933399648945,0.7916061980958494,0.009053236895920969,0.11903626915174303,0.7450907828191498,0.9030963354113655,0.721548587886377,0.6194157917775265,0.8473982001461507,0.19388791931315075,0.5634102228992569,0.14930234998627145,0.5767936882840858,0.6254679154541722,0.5493226129909401,0.13253371858037666,0.8645831144464169,0.11860455259148994,0.6964199581582383,0.8037661364267618,0.9185194959570996,0.29485063677676326,0.37136758377041434,0.9182489648431973,0.5588793204291799,0.626124863258721,0.6199601230295003,0.5742688198265893,0.8098036851961455,0.5428195484193802,0.03313855736781901,0.5052375032894834,0.4152966507506889,0.5730397594074149,0.4741150836393514,0.9237054657947871,0.3918363117873802,0.7420830495442176,0.05550520897196942,0.454548448738214,0.9800804719737133,0.13308127648861423,0.5082821712786226,0.18038641524484145,0.6553759598245984,0.4814219913657708,0.485069543065351,0.39371545815115827,0.18783878509391627,0.8915785641113297,0.9502061984716622,0.6731100505482613,0.6803669776617831,0.5837794476602816,0.5612678383232886,0.6747115337613536,0.7544348520178047,0.6905076761290994,0.27047350648563395,0.02963005979081179,0.2216510587728896,0.9981287117385645,0.5683692112465719,0.05977394321588425,0.018075969153346194,0.2849682264071378,0.24153560985277955,0.8325618354938007,0.585427658642082,0.5532711347495184,0.8046701422910348,0.641233382524126,0.8977997578862262,0.9110196422400799,0.49334422587207294,0.5196950640814514,0.15077724663609737,0.516056258757834,0.5958508433767818,0.5845301179816079,0.7931357989879567,0.04147582833239272,0.584404103282441,0.07241703333973126,0.7067715251493724,0.9913603091732229,0.9024828607685663,0.8509395774405235,0.1268950463431886,0.29551166126462713,0.6779124212303163,0.5839239443308885,0.012770218726453342,0.9218728219892482,0.38692260126020206,0.541416301482425,0.23494285766967704,0.39091357138725835,0.47597593706392527,0.8706799985220235,0.3251765809080984,0.5485021222806872,0.9537278470587877,0.22837550669921514,0.22140042122376602,0.6903566904751717,0.583813357597789,0.0322681913366496,0.19293307109000712,0.9489857721012873,0.28219881283101245,0.5458828845904421,0.8582071263993473,0.4549409442022342,0.26359358495699736,0.7378687920923339,0.09059550944497541,0.9458439831451225,0.40337606907806356,0.15585867396446418,0.03455750612027697,0.2187454578144663,0.27612415411392177,0.024829977472216935,0.6246655313863999,0.25073209645344263,0.6757688046097479,0.13776069690825743,0.21107534180565046,0.3473541957729318,0.4521862181559313,0.5701784040546495,0.04525668412813211,0.07646227121873961,0.2695434935392681,0.09905916879446486,0.07633527007949359,0.3970069872875768,0.2472130408930553,0.1293242814067801,0.6780129235050146,0.9531479455428433,0.7695680069670272,0.9734437594855521,0.3712997196763983,0.20655272256267998,0.566983271014436,0.801938779691338,0.6954777649816392,0.2253866644181266,0.8785791879745227,0.7774814896593576,0.38867354348225547,0.6211933551561728,0.1431175864877282,0.05370507763888033,0.39463964787991934,0.33447869610538217,0.2336048770815744,0.40355904325451786,0.2012865683269912,0.32839304559431115,0.14546818429302788,0.619752567875878,0.35552692035770217,0.6705744229321384,0.27358947997147287,0.1926198191334667,0.14464127518907766,0.3344085401711162,0.45917007683937916,0.07585539300753907,0.2754999910741507,0.5855678263763453,0.773881258438989,0.2012920276323561,0.23949915095923413,0.5499193017473104,0.2911232679676167,0.5107019199531527,0.055838332970340354,0.12435835701379283,0.9612693698093653,0.8902685168622363,0.6301135439764178,0.0026323445791985867,0.7024449458738975,0.24157939025298936,0.47249718017406495,0.514557890476353,0.16445284840738217,0.9292248906044434,0.08900692183025793,0.4414778080037062,0.09166907246764344,0.7406099274608489,0.8062486102023392,0.8086578760395048,0.1438512112889968,0.31093964465333146,0.3411898381635424,0.46794417341716854,0.7819366003679236,0.7171957918446704,0.4322093990978042,0.8940517858727326,0.31253150594547763,0.2121451008833387,0.7902216844343126,0.7981732607252644,0.17821997536028955,0.004606570691111589,0.2205490576397986,0.2888029452506504,0.587428624007503,0.06418907262430018,0.492763775852575,0.947106646285774,0.5951976376199455,0.10184829743005619,0.8464287460212493,0.49963069733751075,0.20134976958070538,0.09699946648758728,0.42033209049038023,0.6639261431638578,0.9908622279109702,0.9602973266771248,0.7548129874773377,0.5483616265636753,0.1532352302688954,0.1318520337324025,0.007275016824394465,0.8089223381475892,0.4136036022670804,0.17368944943975861,0.24872044405408789,0.4329827600420798,0.023482494716126623,0.9286096556805836,0.9640253865808285,0.6344995225658668,0.15960722389891147,0.3169947597416234,0.14679639874471084,0.3540919196385428,0.806704928882802,0.4639362325282127,0.4520696650329692,0.05445223569306734,0.584834500215388,0.5412666905896325,0.7886824892598129,0.7554730626792603,0.01741790902058904,0.4532111027698381,0.05992082744762306,0.27691418874680307,0.9931875740258476,0.8912635348101967,0.4707175393103593,0.9319394051724779,0.32638473952489555,0.9464843903135627,0.46094724699393175,0.046142048248974166,0.012496591151751169,0.6284076389311907,0.25020801598514364,0.4133210538546309,0.2211141130035683,0.6939814594471003,0.32878131326014626,0.03763942954736854,0.38279654080658176,0.8075046014210151,0.43751658614964084,0.7281212090528818,0.521243741957214,0.7022858220247234,0.8440279052555334,0.4582940499846587,0.8265839592310353,0.23806485795603505,0.7329648098289538,0.6492818785997114,0.5968780101297919,0.9862510677276694,0.5392857982203049,0.7183896075507462,0.8838103593460346,0.31574911098929725,0.9590669458508175,0.5082336408430634,0.5276451369581083,0.42075562795225185,0.4552479680493966,0.41779743451104967,0.10153519803581001,0.27219640112197363,0.16498816273189476,0.669627827457159,0.9644616172366756,0.16096391005292643,0.9309138458969695,0.914346762386675,0.9635665830659264,0.5267853829108656,0.4720154121289225,0.9798772099290661,0.7977765801303043,0.9274963524428403,0.6734032555258226,0.29877303906269714,0.8203347664482837,0.060806977441732135,0.3608707946369618,0.7929410975417731,0.0698676126472928,0.9221606313089348,0.5059411740744274,0.7536164865079619,0.6902187253479722,0.43161592314896235,0.6410368504307834,0.3051619849411219,0.7010077325629575,0.17337762886416508,0.25421975243992456,0.6369726664707343,0.31468663094688676,0.7723957429498525,0.5651826578084858,0.9635816491201927,0.1682307969050889,0.6597772942563886,0.7413078368341781,0.8463745542806846,0.9565313823933936,0.7636644821166642,0.7893624627878081,0.10364616054737474,0.4270645044652155,0.1624074148545931,0.6555855815066869,0.5593459552491608,0.021475593459973075,0.6598050165658945,0.14138828759011335,0.5854446017436518,0.8767598254081954,0.5519274625259885,0.2982283531004213,0.1284783182489444,0.3530211119944515,0.5376828456688776,0.6287742852998217,0.6245500225770957,0.5443425107732004,0.8660127233652473,0.018848214604549107,0.5100279296737366,0.6469981030898746,0.7206265886288754,0.08415301184688229,0.8178159311974516,0.21488301459070835,0.7605800393956791,0.24578396440369232,0.055238128675074716,0.6805227032774783,0.4454236091987448,0.7567861124476581,0.15498452004727103,0.1644293562060718,0.03737197225540445,0.2114287718380169,0.4706263420942943,0.5474931232244428,0.6316250671630816,0.9876295374884866,0.44992932586765877,0.9014617138969742,0.4101744776912397,0.1270656926368522,0.1983818297267702,0.04249137686876747,0.3117761753696847,0.3907340997520288,0.753840386502226,0.3866159896002155,0.22940611647359987,0.9862657540175113,0.6240341015607992,0.4062292187844362,0.19998037834463678,0.8781796798057545,0.2544126008922589,0.7494433003844673,0.9547237615499343,0.17044541665389934,0.12422409772644138,0.9332778791537212,0.9666590902592093,0.4905737758356621,0.4753415328218321,0.488979744162817,0.1411694282380258,0.32782310959886163,0.10843441119839481,0.5131192988354606,0.25608131506590626,0.9253835648638972,0.7281457370137354,0.13292475613758659,0.3668391354491193,0.3372841988965698,0.45191438582518606,0.30123154440181754,0.6101755893654432,0.8820544115440551,0.25835380432100463,0.425322976509073,0.06521434818098737,0.9929020560605857,0.47012108177041034,0.8173004540632879,0.3965157961760365,0.21897685600342187,0.3350683961042502,0.2268884837184939,0.6507475656848847,0.7905752819796555,0.4509461597141592,0.662866354223033,0.028324445428748013,0.3613714985744493,0.38852284025021067,0.07743557445623883,0.9084977745585732,0.9595480872311128,0.7143516012505485,0.5808955825329831,0.4475188586608201,0.8316332704498779,0.4512045244707277,0.4009467951002782,0.2784719607116126,0.88995846366323,0.8325794604364273,0.4632262769413228,0.23763631296866639,0.33376212628866486,0.28936184363399076,0.6928609471929466,0.08620294420979646,0.3303476406484923,0.8318326409820047,0.901489079272297,0.2631384133228438,0.6280947141265883,0.5609029779380212,0.4605295572350139,0.13469148010917642,0.22073034995281327,0.6725442800375568,0.023483216977745802,0.7774879144489807,0.585399784262161,0.7423027632927527,0.5146905698868931,0.621984306389575,0.01764713575856991,0.7469014989779115,0.1532406590445815,0.49149364067270196,0.07281782353697286,0.2362429059927661,0.6655946121690696,0.04918843702646447,0.907419307873152,0.8605686661769886,0.061115316427201916,0.25005849702308436,0.5883883841369708,0.5830885225616599,0.2583646777951283,0.6021773369981988,0.7303984898572166,0.6127618030439191], 39)) # 0.00000